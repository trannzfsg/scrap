<html>
  <head>
    <style>
      table, th, td {
        font-size:11px;
        border:1px solid #f0f0f0;
        border-collapse: collapse;
      }
    </style>
  </head>
  <body style='font-family:Verdana, Geneva, Tahoma, sans-serif;'>
    <label for="name">Name: </label><input type="text" name="name" id="name" />
    <br /><br />
    <label for="location">Location (postcode or suburb): </label><input type="text" name="location" id="location" />
    <br /><br />
    <button onclick="javascript:search();" style="width:100px;height:30px;text-align:center;">Search</button>
    <br /><br />
    ------------------------
    <br /><br />
    <label for="serverurl">API url: </label><input type="text" name="serverurl" id="serverurl" value="https://hnbp7pcz97.execute-api.ap-southeast-2.amazonaws.com/dev/" /> (local use http://localhost:3000/)
    <br /><br />
    <label for="fbaarecaptcha">FBAA recaptcha token: </label><input type="text" name="fbaarecaptcha" id="fbaarecaptcha" value="03AOLTBLThmR6uRIYHkDUvTFppepZhFKQ5BuQmGCwOx5MGD0iG-lPSTF5alIuB7kO_r4VXs8MyM559K0mwSaR2Sdh6nJzjF5t_JmmU3uXFp4UE7wkg83bLlNJWPKVqqijepNiwSTsFzt6RUMp9pApUf14dQK0_eLLjDK9joly5pFtLZoXRbbuugtIDF7vm8eQmgtS21skQWenA34Zl5WUFgywhYd85O7cAMLY_nWjeG0ZPNYYdWTwQu0LK2e-CDzJxl90jDosiiBqWqpd5CLNUAQlfZxWFcSAHpJ2CwhF2LMbRyTg5uf_4lmrmyt3HHR4Ph8VKQb7807jm" /> (<a href="https://www.fbaa.com.au/members/find-a-broker/" target="_blank">click here</a> to get new "recaptcha" from chrome dev tools)
    <br /><br />
    <label for="fbaasecure">FBAA secure token: </label><input type="text" name="fbaasecure" id="fbaasecure" value="c140bd1c95" target="_blank"> (<a href="https://www.fbaa.com.au/members/find-a-broker/" target="_blank">click here</a> to get new "fbaasearchsecure" token from chrome dev tools)
    <br /><br />
    ------------------------
    <br /><br />
    <div id="response">please start searching</div>
    <script>
        let search = () => {
            document.getElementById('response').innerHTML = 'loading...';
            let name = document.getElementById('name').value;
            let location = document.getElementById('location').value;
            if(name.replace(/\ /g,'')==='' && location.replace(/\ /g,'')==='') {
              alert('please enter name or location or both');
              return;
            }
            let serverurl = document.getElementById('serverurl').value;
            let fbaarecaptcha = document.getElementById('fbaarecaptcha').value;
            let fbaasecure = document.getElementById('fbaasecure').value;
            let url = serverurl;
            url += '?query=';
            if(name.replace(/\ /g,'')!==''){
              url += name;
            }
            url += '&location=';
            if(location.replace(/\ /g,'')!==''){
              url += location;
            }
            url += '&fbaarecaptcha=';
            if(fbaarecaptcha.replace(/\ /g,'')!==''){
              url += fbaarecaptcha;
            }
            url += '&fbaasecure=';
            if(fbaasecure.replace(/\ /g,'')!==''){
              url += fbaasecure;
            }
            let xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function () {
              if(xhr.readyState === 4 && xhr.status === 200) {
                let res = JSON.parse(xhr.responseText);
                let reshtml = '';
                //if error (fbaa recaptcha/secure expires)
                if (res.error !== null)
                  reshtml += 'API error: ' + res.error.message + '<br />' + res.error.stack + '<br /><br />';
                //MFAA results
                if (res.MFAAadvisers && res.MFAAadvisers.length > 0)
                  reshtml += '<strong>MFAA results<strong><br /><br />' + json2table(res.MFAAadvisers);
                else  
                  reshtml += 'Cannot find any adviser on MFAA';
                reshtml += '<br /><br />';
                //FBAA results
                if (res.FBAAadvisers && res.FBAAadvisers.length > 0)
                  reshtml += '<strong>FBAA results<strong><br /><br />' + json2table(res.FBAAadvisers);
                else
                  reshtml += 'Cannot find any adviser on FBAA';
                document.getElementById('response').innerHTML = reshtml;
              }
              else if(xhr.readyState === 4) {
                document.getElementById('response').innerHTML = 'API error: ' + xhr.statusText + '. ' + xhr.responseText;
              }
            };
            xhr.send();
        };
        let json2table = (json, classes) => {
          let cols = Object.keys(json[0]);
          let headerRow = '';
          let bodyRows = '';
          classes = classes || '';
          cols.map(function(col) {
            headerRow += '<th>' + col + '</th>';
          });
          json.map(function(row) {
            bodyRows += '<tr>';
            cols.map(function(colName) {
              bodyRows += '<td>' + row[colName] + '</td>';
            });
            bodyRows += '</tr>';
          });
          return '<table class="' + classes + '"><thead><tr>' + headerRow + '</tr></thead><tbody>' + bodyRows + '</tbody></table>';
        };
    </script>
  </body>
</html>